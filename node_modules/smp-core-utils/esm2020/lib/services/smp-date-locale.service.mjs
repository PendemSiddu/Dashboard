import { Injectable } from "@angular/core";
import { NativeDateAdapter } from "@angular/material/core";
import { includes } from "lodash";
import * as i0 from "@angular/core";
const smpSep = "/";
const smpDay = "d";
const smpDayDoubled = "dd";
const smpMonth = "M";
const smpMonthDoubled = "MM";
const smpYear = "yyyy";
const smpCurrentYear = new Date().getFullYear();
const smpCentury = Math.round(smpCurrentYear / 100);
export const SMP_LOCALE_IT_IT = "it-IT";
export const SMP_LOCALE_EN_GB = "en-GB";
export const SMP_LOCALE_EN_US = "en-US";
export const SMP_FORMATS = {
    "it-IT": `${smpDayDoubled}${smpSep}${smpMonthDoubled}${smpSep}${smpYear}`,
    "en-GB": `${smpDayDoubled}${smpSep}${smpMonthDoubled}${smpSep}${smpYear}`,
    "en-US": `${smpMonth}${smpSep}${smpDay}${smpSep}${smpYear}`
};
export const SMP_DATE_FORMATS_IT = {
    parse: {
        dateInput: { month: "numeric", year: "numeric", day: "numeric" }
    },
    display: {
        dateInput: SMP_FORMATS[SMP_LOCALE_IT_IT],
        monthYearLabel: `${smpMonthDoubled}${smpSep}${smpYear}`,
        dateA11yLabel: SMP_FORMATS[SMP_LOCALE_IT_IT],
        monthYearA11yLabel: `${smpMonthDoubled}${smpSep}${smpYear}`
    }
};
export const SMP_DATE_FORMATS_EN_GB = {
    parse: {
        dateInput: { month: "numeric", year: "numeric", day: "numeric" }
    },
    display: {
        dateInput: SMP_FORMATS[SMP_LOCALE_EN_GB],
        monthYearLabel: `${smpMonthDoubled}${smpSep}${smpYear}`,
        dateA11yLabel: SMP_FORMATS[SMP_LOCALE_EN_GB],
        monthYearA11yLabel: `${smpMonthDoubled}${smpSep}${smpYear}`
    }
};
export const SMP_DATE_FORMATS_EN_US = {
    parse: {
        dateInput: { month: "numeric", year: "numeric", day: "numeric" }
    },
    display: {
        dateInput: SMP_FORMATS[SMP_LOCALE_EN_US],
        monthYearLabel: `${smpMonth}${smpSep}${smpYear}`,
        dateA11yLabel: SMP_FORMATS[SMP_LOCALE_EN_US],
        monthYearA11yLabel: `${smpMonth}${smpSep}${smpYear}`
    }
};
export class SmpMatDateLocale extends NativeDateAdapter {
    constructor() {
        super(...arguments);
        this.display = SMP_DATE_FORMATS_EN_GB.display;
    }
    get currentLocale() {
        return this.locale;
    }
    format(date, _displayFormat_) {
        const day = date.getDate();
        const month = date.getMonth() + 1;
        const year = date.getFullYear();
        switch (this.display.dateInput) {
            case SMP_DATE_FORMATS_IT.display.dateInput:
                return this._addLeadingZeroes(day) + smpSep + this._addLeadingZeroes(month) + smpSep + year;
            case SMP_DATE_FORMATS_EN_GB.display.dateInput:
                return this._addLeadingZeroes(day) + smpSep + this._addLeadingZeroes(month) + smpSep + year;
            case SMP_DATE_FORMATS_EN_US.display.dateInput:
                return month + smpSep + day + smpSep + year;
            default:
                let formattedDate = "";
                try {
                    formattedDate = date.toLocaleDateString(SMP_LOCALE_EN_GB);
                }
                catch (e) {
                    console.warn("Caught error while printing ", e);
                    formattedDate = date.toDateString();
                }
                return formattedDate;
        }
    }
    parse(value) {
        if (typeof value === typeof "" && value.length > 0) {
            const str = value.split(smpSep);
            if (str.length < 3) {
                return new Date("smp");
            }
            if (str[2].length < 4) {
                str[2] = smpCentury + str[2];
            }
            if (str[2].length !== 4) {
                return new Date("smp");
            }
            if (includes([SMP_DATE_FORMATS_IT.display.dateInput, SMP_DATE_FORMATS_EN_GB.display.dateInput], this.display.dateInput)) {
                return new Date(+str[2], +str[1] - 1, +str[0]);
            }
            else if (this.display.dateInput === SMP_DATE_FORMATS_EN_US.display.dateInput) {
                return new Date(+str[2], +str[0] - 1, +str[1]);
            }
        }
        else {
            console.warn("Date input format not valid." +
                " Be sure to use SMP_DATE_FORMATS" +
                " or extend this class with your own 'parser' and format 'methods'");
            return null;
        }
    }
    setLocale(locale) {
        switch (locale) {
            case SMP_LOCALE_IT_IT:
                this.display = SMP_DATE_FORMATS_IT.display;
                break;
            case SMP_LOCALE_EN_GB:
                this.display = SMP_DATE_FORMATS_EN_GB.display;
                break;
            case SMP_LOCALE_EN_US:
                this.display = SMP_DATE_FORMATS_EN_US.display;
                break;
            default:
                this.display = SMP_DATE_FORMATS_EN_GB.display;
                break;
        }
        super.setLocale(locale);
    }
    _addLeadingZeroes(n) {
        return `0${n}`.slice(-2);
    }
}
SmpMatDateLocale.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: SmpMatDateLocale, deps: null, target: i0.ɵɵFactoryTarget.Injectable });
SmpMatDateLocale.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: SmpMatDateLocale });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: SmpMatDateLocale, decorators: [{
            type: Injectable
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic21wLWRhdGUtbG9jYWxlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zbXAtY29yZS11dGlscy9zcmMvbGliL3NlcnZpY2VzL3NtcC1kYXRlLWxvY2FsZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDekMsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFLekQsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLFFBQVEsQ0FBQzs7QUFFaEMsTUFBTSxNQUFNLEdBQVcsR0FBRyxDQUFDO0FBQzNCLE1BQU0sTUFBTSxHQUFXLEdBQUcsQ0FBQztBQUMzQixNQUFNLGFBQWEsR0FBVyxJQUFJLENBQUM7QUFDbkMsTUFBTSxRQUFRLEdBQVcsR0FBRyxDQUFDO0FBQzdCLE1BQU0sZUFBZSxHQUFXLElBQUksQ0FBQztBQUNyQyxNQUFNLE9BQU8sR0FBVyxNQUFNLENBQUM7QUFDL0IsTUFBTSxjQUFjLEdBQVcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztBQUN4RCxNQUFNLFVBQVUsR0FBVyxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsR0FBRyxHQUFHLENBQUMsQ0FBQztBQUU1RCxNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBVyxPQUFPLENBQUM7QUFDaEQsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQVcsT0FBTyxDQUFDO0FBQ2hELE1BQU0sQ0FBQyxNQUFNLGdCQUFnQixHQUFXLE9BQU8sQ0FBQztBQUVoRCxNQUFNLENBQUMsTUFBTSxXQUFXLEdBQUc7SUFDdkIsT0FBTyxFQUFFLEdBQUcsYUFBYSxHQUFHLE1BQU0sR0FBRyxlQUFlLEdBQUcsTUFBTSxHQUFHLE9BQU8sRUFBRTtJQUN6RSxPQUFPLEVBQUUsR0FBRyxhQUFhLEdBQUcsTUFBTSxHQUFHLGVBQWUsR0FB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LFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBRU8saUJBQWlCLENBQUMsQ0FBUztRQUMvQixPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDN0IsQ0FBQzs7NkdBcEZRLGdCQUFnQjtpSEFBaEIsZ0JBQWdCOzJGQUFoQixnQkFBZ0I7a0JBRDVCLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdGFibGV9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQge05hdGl2ZURhdGVBZGFwdGVyfSBmcm9tIFwiQGFuZ3VsYXIvbWF0ZXJpYWwvY29yZVwiO1xuaW1wb3J0IHtNYXREYXRlRm9ybWF0c30gZnJvbSBcIkBhbmd1bGFyL21hdGVyaWFsL2NvcmUvZGF0ZXRpbWUvZGF0ZS1mb3JtYXRzXCI7XG4vL1xuaW1wb3J0IHtTbXBEYXRlRGlzcGxheX0gZnJvbSBcIi4uL21vZGVscy9zbXAtZGF0ZS1kaXNwbGF5Lm1vZGVsXCI7XG4vL1xuaW1wb3J0IHtpbmNsdWRlc30gZnJvbSBcImxvZGFzaFwiO1xuXG5jb25zdCBzbXBTZXA6IHN0cmluZyA9IFwiL1wiO1xuY29uc3Qgc21wRGF5OiBzdHJpbmcgPSBcImRcIjtcbmNvbnN0IHNtcERheURvdWJsZWQ6IHN0cmluZyA9IFwiZGRcIjtcbmNvbnN0IHNtcE1vbnRoOiBzdHJpbmcgPSBcIk1cIjtcbmNvbnN0IHNtcE1vbnRoRG91YmxlZDogc3RyaW5nID0gXCJNTVwiO1xuY29uc3Qgc21wWWVhcjogc3RyaW5nID0gXCJ5eXl5XCI7XG5jb25zdCBzbXBDdXJyZW50WWVhcjogbnVtYmVyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpO1xuY29uc3Qgc21wQ2VudHVyeTogbnVtYmVyID0gTWF0aC5yb3VuZChzbXBDdXJyZW50WWVhciAvIDEwMCk7XG5cbmV4cG9ydCBjb25zdCBTTVBfTE9DQUxFX0lUX0lUOiBzdHJpbmcgPSBcIml0LUlUXCI7XG5leHBvcnQgY29uc3QgU01QX0xPQ0FMRV9FTl9HQjogc3RyaW5nID0gXCJlbi1HQlwiO1xuZXhwb3J0IGNvbnN0IFNNUF9MT0NBTEVfRU5fVVM6IHN0cmluZyA9IFwiZW4tVVNcIjtcblxuZXhwb3J0IGNvbnN0IFNNUF9GT1JNQVRTID0ge1xuICAgIFwiaXQtSVRcIjogYCR7c21wRGF5RG91YmxlZH0ke3NtcFNlcH0ke3NtcE1vbnRoRG91YmxlZH0ke3NtcFNlcH0ke3NtcFllYXJ9YCxcbiAgICBcImVuLUdCXCI6IGAke3NtcERheURvdWJsZWR9JHtzbXBTZXB9JHtzbXBNb250aERvdWJsZWR9JHtzbXBTZXB9JHtzbXBZZWFyfWAsXG4gICAgXCJlbi1VU1wiOiBgJHtzbXBNb250aH0ke3NtcFNlcH0ke3NtcERheX0ke3NtcFNlcH0ke3NtcFllYXJ9YFxufTtcblxuZXhwb3J0IGNvbnN0IFNNUF9EQVRFX0ZPUk1BVFNfSVQ6IE1hdERhdGVGb3JtYXRzID0ge1xuICAgIHBhcnNlOiB7XG4gICAgICAgIGRhdGVJbnB1dDoge21vbnRoOiBcIm51bWVyaWNcIiwgeWVhcjogXCJudW1lcmljXCIsIGRheTogXCJudW1lcmljXCJ9XG4gICAgfSxcbiAgICBkaXNwbGF5OiB7XG4gICAgICAgIGRhdGVJbnB1dDogU01QX0ZPUk1BVFNbU01QX0xPQ0FMRV9JVF9JVF0sXG4gICAgICAgIG1vbnRoWWVhckxhYmVsOiBgJHtzbXBNb250aERvdWJsZWR9JHtzbXBTZXB9JHtzbXBZZWFyfWAsXG4gICAgICAgIGRhdGVBMTF5TGFiZWw6IFNNUF9GT1JNQVRTW1NNUF9MT0NBTEVfSVRfSVRdLFxuICAgICAgICBtb250aFllYXJBMTF5TGFiZWw6IGAke3NtcE1vbnRoRG91YmxlZH0ke3NtcFNlcH0ke3NtcFllYXJ9YFxuICAgIH1cbn07XG5cbmV4cG9ydCBjb25zdCBTTVBfREFURV9GT1JNQVRTX0VOX0dCOiBNYXREYXRlRm9ybWF0cyA9IHtcbiAgICBwYXJzZToge1xuICAgICAgICBkYXRlSW5wdXQ6IHttb250aDogXCJudW1lcmljXCIsIHllYXI6IFwibnVtZXJpY1wiLCBkYXk6IFwibnVtZXJpY1wifVxuICAgIH0sXG4gICAgZGlzcGxheToge1xuICAgICAgICBkYXRlSW5wdXQ6IFNNUF9GT1JNQVRTW1NNUF9MT0NBTEVfRU5fR0JdLFxuICAgICAgICBtb250aFllYXJMYWJlbDogYCR7c21wTW9udGhEb3VibGVkfSR7c21wU2VwfSR7c21wWWVhcn1gLFxuICAgICAgICBkYXRlQTExeUxhYmVsOiBTTVBfRk9STUFUU1tTTVBfTE9DQUxFX0VOX0dCXSxcbiAgICAgICAgbW9udGhZZWFyQTExeUxhYmVsOiBgJHtzbXBNb250aERvdWJsZWR9JHtzbXBTZXB9JHtzbXBZZWFyfWBcbiAgICB9XG59O1xuXG5leHBvcnQgY29uc3QgU01QX0RBVEVfRk9STUFUU19FTl9VUzogTWF0RGF0ZUZvcm1hdHMgPSB7XG4gICAgcGFyc2U6IHtcbiAgICAgICAgZGF0ZUlucHV0OiB7bW9udGg6IFwibnVtZXJpY1wiLCB5ZWFyOiBcIm51bWVyaWNcIiwgZGF5OiBcIm51bWVyaWNcIn1cbiAgICB9LFxuICAgIGRpc3BsYXk6IHtcbiAgICAgICAgZGF0ZUlucHV0OiBTTVBfRk9STUFUU1tTTVBfTE9DQUxFX0VOX1VTXSxcbiAgICAgICAgbW9udGhZZWFyTGFiZWw6IGAke3NtcE1vbnRofSR7c21wU2VwfSR7c21wWWVhcn1gLFxuICAgICAgICBkYXRlQTExeUxhYmVsOiBTTVBfRk9STUFUU1tTTVBfTE9DQUxFX0VOX1VTXSxcbiAgICAgICAgbW9udGhZZWFyQTExeUxhYmVsOiBgJHtzbXBNb250aH0ke3NtcFNlcH0ke3NtcFllYXJ9YFxuICAgIH1cbn07XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBTbXBNYXREYXRlTG9jYWxlIGV4dGVuZHMgTmF0aXZlRGF0ZUFkYXB0ZXIge1xuXG4gICAgZ2V0IGN1cnJlbnRMb2NhbGUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlO1xuICAgIH1cblxuICAgIGRpc3BsYXk6IFNtcERhdGVEaXNwbGF5ID0gU01QX0RBVEVfRk9STUFUU19FTl9HQi5kaXNwbGF5O1xuXG4gICAgZm9ybWF0KGRhdGU6IERhdGUsIF9kaXNwbGF5Rm9ybWF0Xzogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgZGF5ID0gZGF0ZS5nZXREYXRlKCk7XG4gICAgICAgIGNvbnN0IG1vbnRoID0gZGF0ZS5nZXRNb250aCgpICsgMTtcbiAgICAgICAgY29uc3QgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgc3dpdGNoICh0aGlzLmRpc3BsYXkuZGF0ZUlucHV0KSB7XG4gICAgICAgICAgICBjYXNlIFNNUF9EQVRFX0ZPUk1BVFNfSVQuZGlzcGxheS5kYXRlSW5wdXQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FkZExlYWRpbmdaZXJvZXMoZGF5KSArIHNtcFNlcCArIHRoaXMuX2FkZExlYWRpbmdaZXJvZXMobW9udGgpICsgc21wU2VwICsgeWVhcjtcbiAgICAgICAgICAgIGNhc2UgU01QX0RBVEVfRk9STUFUU19FTl9HQi5kaXNwbGF5LmRhdGVJbnB1dDpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWRkTGVhZGluZ1plcm9lcyhkYXkpICsgc21wU2VwICsgdGhpcy5fYWRkTGVhZGluZ1plcm9lcyhtb250aCkgKyBzbXBTZXAgKyB5ZWFyO1xuICAgICAgICAgICAgY2FzZSBTTVBfREFURV9GT1JNQVRTX0VOX1VTLmRpc3BsYXkuZGF0ZUlucHV0OlxuICAgICAgICAgICAgICAgIHJldHVybiBtb250aCArIHNtcFNlcCArIGRheSArIHNtcFNlcCArIHllYXI7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGxldCBmb3JtYXR0ZWREYXRlID0gXCJcIjtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWREYXRlID0gZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoU01QX0xPQ0FMRV9FTl9HQik7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJDYXVnaHQgZXJyb3Igd2hpbGUgcHJpbnRpbmcgXCIsIGUpO1xuICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWREYXRlID0gZGF0ZS50b0RhdGVTdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVkRGF0ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHBhcnNlKHZhbHVlOiBhbnkpOiBEYXRlIHwgbnVsbCB7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IHR5cGVvZiBcIlwiICYmIHZhbHVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHN0ciA9IHZhbHVlLnNwbGl0KHNtcFNlcCk7XG4gICAgICAgICAgICBpZiAoc3RyLmxlbmd0aCA8IDMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoXCJzbXBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3RyWzJdLmxlbmd0aCA8IDQpIHtcbiAgICAgICAgICAgICAgICBzdHJbMl0gPSBzbXBDZW50dXJ5ICsgc3RyWzJdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN0clsyXS5sZW5ndGggIT09IDQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoXCJzbXBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBkZC9NTS95eXl5XG4gICAgICAgICAgICBpZiAoaW5jbHVkZXMoW1NNUF9EQVRFX0ZPUk1BVFNfSVQuZGlzcGxheS5kYXRlSW5wdXQsIFNNUF9EQVRFX0ZPUk1BVFNfRU5fR0IuZGlzcGxheS5kYXRlSW5wdXRdLCB0aGlzLmRpc3BsYXkuZGF0ZUlucHV0KSkge1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCtzdHJbMl0sICtzdHJbMV0gLSAxLCArc3RyWzBdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIE0vZC95eXl5XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmRpc3BsYXkuZGF0ZUlucHV0ID09PSBTTVBfREFURV9GT1JNQVRTX0VOX1VTLmRpc3BsYXkuZGF0ZUlucHV0KSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoK3N0clsyXSwgK3N0clswXSAtIDEsICtzdHJbMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiRGF0ZSBpbnB1dCBmb3JtYXQgbm90IHZhbGlkLlwiICtcbiAgICAgICAgICAgICAgICBcIiBCZSBzdXJlIHRvIHVzZSBTTVBfREFURV9GT1JNQVRTXCIgK1xuICAgICAgICAgICAgICAgIFwiIG9yIGV4dGVuZCB0aGlzIGNsYXNzIHdpdGggeW91ciBvd24gJ3BhcnNlcicgYW5kIGZvcm1hdCAnbWV0aG9kcydcIik7XG5cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2V0TG9jYWxlKGxvY2FsZTogYW55KSB7XG4gICAgICAgIHN3aXRjaCAobG9jYWxlKSB7XG4gICAgICAgICAgICBjYXNlIFNNUF9MT0NBTEVfSVRfSVQ6XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5ID0gU01QX0RBVEVfRk9STUFUU19JVC5kaXNwbGF5O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTTVBfTE9DQUxFX0VOX0dCOlxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSA9IFNNUF9EQVRFX0ZPUk1BVFNfRU5fR0IuZGlzcGxheTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU01QX0xPQ0FMRV9FTl9VUzpcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkgPSBTTVBfREFURV9GT1JNQVRTX0VOX1VTLmRpc3BsYXk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSA9IFNNUF9EQVRFX0ZPUk1BVFNfRU5fR0IuZGlzcGxheTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBzdXBlci5zZXRMb2NhbGUobG9jYWxlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9hZGRMZWFkaW5nWmVyb2VzKG46IG51bWJlcikge1xuICAgICAgICByZXR1cm4gYDAke259YC5zbGljZSgtMik7XG4gICAgfVxufVxuIl19